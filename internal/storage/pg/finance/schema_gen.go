// Code generated by sqlgen. DO NOT EDIT.
package financepg

import (
	"context"
	"database/sql"
	"github.com/jmoiron/sqlx"
	"time"
)

const (
	// GetBudgetByIDQuery is the SQL for the 'GetBudgetByID' query.
	GetBudgetByIDQuery = `
SELECT
  id,
  space_id,
  name,
  description,
  color,
  icon_name,
  amount_currency,
  amount_cents,
  create_time,
  create_by,
  update_time,
  update_by
FROM
  finance.budgets
WHERE
  id =:id
  AND space_id =:space_id
LIMIT
  1;`

	// ListBudgetsQuery is the SQL for the 'ListBudgets' query.
	ListBudgetsQuery = `
SELECT
  id,
  space_id,
  name,
  description,
  color,
  icon_name,
  amount_currency,
  amount_cents,
  create_time,
  create_by,
  update_time,
  update_by
FROM
  finance.budgets
WHERE
  space_id =:space_id
ORDER BY
  create_time DESC;`

	// UpsertBudgetQuery is the SQL for the 'UpsertBudget' query.
	UpsertBudgetQuery = `
INSERT INTO
  finance.budgets (
    id,
    space_id,
    name,
    description,
    color,
    icon_name,
    amount_currency,
    amount_cents,
    create_time,
    create_by,
    update_time,
    update_by
  )
VALUES
  (
:id,
:space_id,
:name,
:description,
:color,
:icon_name,
:amount_currency,
:amount_cents,
:create_time,
:create_by,
:update_time,
:update_by
  )
ON CONFLICT (id, space_id) DO UPDATE
SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  color = EXCLUDED.color,
  icon_name = EXCLUDED.icon_name,
  update_time = EXCLUDED.update_time,
  update_by = EXCLUDED.update_by
RETURNING
  id,
  space_id,
  name,
  description,
  color,
  icon_name,
  amount_currency,
  amount_cents,
  create_time,
  create_by,
  update_time,
  update_by;`

	// DeleteBudgetByIDQuery is the SQL for the 'DeleteBudgetByID' query.
	DeleteBudgetByIDQuery = `
DELETE FROM finance.budgets
WHERE
  id =:id
  AND space_id =:space_id;`
)

// BudgetEntity represents a row from the 'budgets' table.
type BudgetEntity struct {
	Id             string    `db:"id"`
	SpaceId        string    `db:"space_id"`
	Name           string    `db:"name"`
	Description    *string   `db:"description"`
	Color          string    `db:"color"`
	IconName       string    `db:"icon_name"`
	Status         string    `db:"status"`
	AmountCurrency string    `db:"amount_currency"`
	AmountCents    int64     `db:"amount_cents"`
	SearchVector   *any      `db:"search_vector"`
	CreateTime     time.Time `db:"create_time"`
	CreateBy       string    `db:"create_by"`
	UpdateTime     time.Time `db:"update_time"`
	UpdateBy       string    `db:"update_by"`
}

// GetBudgetByIDParams represents the parameters for the 'GetBudgetByID' query.
type GetBudgetByIDParams struct {
	Id      string `db:"id"`
	SpaceId string `db:"space_id"`
}

// ListBudgetsParams represents the parameters for the 'ListBudgets' query.
type ListBudgetsParams struct {
	SpaceId string `db:"space_id"`
}

// UpsertBudgetParams represents the parameters for the 'UpsertBudget' query.
//
// UpsertBudgetParams is an alias of [BudgetEntity].
type UpsertBudgetParams = BudgetEntity

// DeleteBudgetByIDParams represents the parameters for the 'DeleteBudgetByID' query.
type DeleteBudgetByIDParams struct {
	Id      string `db:"id"`
	SpaceId string `db:"space_id"`
}

// GetBudgetByID executes the 'GetBudgetByID' query and returns a single row.
func GetBudgetByID(ctx context.Context, db sqlx.ExtContext, params *GetBudgetByIDParams) (*BudgetEntity, error) {
	query, args, err := sqlx.Named(GetBudgetByIDQuery, params)
	if err != nil {
		return nil, err
	}

	query = sqlx.Rebind(sqlx.DOLLAR, query)

	var item BudgetEntity
	if err := sqlx.GetContext(ctx, db, &item, query, args...); err != nil {
		return nil, err
	}

	return &item, nil
}

// ListBudgets executes the 'ListBudgets' query and returns multiple rows.
func ListBudgets(ctx context.Context, db sqlx.ExtContext, params *ListBudgetsParams, mapper func(*BudgetEntity) error) error {
	rows, err := sqlx.NamedQueryContext(ctx, db, ListBudgetsQuery, params)
	if err != nil {
		return err
	}
	defer rows.Close()

	for rows.Next() {
		var item BudgetEntity
		if err := rows.StructScan(&item); err != nil {
			return err
		}
		if err := mapper(&item); err != nil {
			return err
		}
	}

	return rows.Err()
}

// UpsertBudget executes the 'UpsertBudget' query and returns a single row.
func UpsertBudget(ctx context.Context, db sqlx.ExtContext, params *UpsertBudgetParams) (*BudgetEntity, error) {
	query, args, err := sqlx.Named(UpsertBudgetQuery, params)
	if err != nil {
		return nil, err
	}

	query = sqlx.Rebind(sqlx.DOLLAR, query)

	var item BudgetEntity
	if err := sqlx.GetContext(ctx, db, &item, query, args...); err != nil {
		return nil, err
	}

	return &item, nil
}

// DeleteBudgetByID executes the 'DeleteBudgetByID' query.
func DeleteBudgetByID(ctx context.Context, e sqlx.ExtContext, params *DeleteBudgetByIDParams) (sql.Result, error) {
	return sqlx.NamedExecContext(ctx, e, DeleteBudgetByIDQuery, params)
}
