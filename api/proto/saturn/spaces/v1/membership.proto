syntax = "proto3";

package saturn.spaces.v1;

import "google/api/annotations.proto";
import "google/api/client.proto";
import "google/api/field_behavior.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/field_mask.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/masterkeysrd/saturn/gen/proto/go/saturn/spaces/v1;spacesv1";

// Members provides features to manage members within a space.
//
// This includes adding new members, updating their roles, removing members,
// and listing all members in a space.
service Members {
  option (google.api.default_host) = "api.saturn.masterkeysrd.dev";

  // Lists all members in the space.
  rpc ListMembers(ListMembersRequest) returns (ListMembersResponse) {
    option (google.api.http) = {get: "/v1/space/members"};
  }

  // Adds a new member to the space.
  // Only users with the OWNER or ADMIN role can add members.
  rpc AddMember(AddMemberRequest) returns (Member) {
    option (google.api.http) = {
      post: "/v1/space/members"
      body: "*"
    };
  }

  // Updates a member's role or information in the space.
  // Only users with the OWNER or ADMIN role can update members. Only
  // OWNERs can change another role to ADMIN.
  rpc UpdateMember(UpdateMemberRequest) returns (Member) {
    option (google.api.http) = {
      patch: "/v1/space/members/{user_id}"
      body: "member"
    };
  }

  // Removes a member from the space.
  // Only users with the OWNER or ADMIN role can remove members. Only OWNERs
  // can remove a member with the ADMIN role.
  rpc RemoveMember(RemoveMemberRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {delete: "/v1/space/members/{user_id}"};
  }
}

// Request message for Members.ListMembers.
message ListMembersRequest {
  // The page number to retrieve.
  int32 page = 1;

  // Number of members to return per page.
  int32 page_size = 2;
}

// Response message for Members.ListMembers.
message ListMembersResponse {
  // The list of members in the space.
  repeated Member members = 1;

  // The total number of members in the space.
  int32 total_size = 2;
}

// Request message for Members.AddMember.
message AddMemberRequest {
  // The member to add.
  oneof target {
    string user_id = 1;
    string email = 2;
  }

  // The role to assign to the new member.
  Member.Role role = 3 [(google.api.field_behavior) = REQUIRED];
}

// Request message for Members.UpdateMember.
message UpdateMemberRequest {
  // The ID of the user whose member data is to be updated.
  string user_id = 1 [(google.api.field_behavior) = REQUIRED];

  // The member data to update.
  Member member = 2 [(google.api.field_behavior) = REQUIRED];

  // Optional. The list of fields to be updated.
  // A mask specifying which fields in the Member resource should be
  // updated. This mask is relative to the Member resource, not the
  // UpdateMemberRequest message. If no mask is provided, all fields
  // will be updated. A special field mask value "*" can be used to
  // indicate that all fields should be updated.
  google.protobuf.FieldMask update_mask = 3 [(google.api.field_behavior) = OPTIONAL];
}

// Request message for Members.RemoveMember.
message RemoveMemberRequest {
  // The ID of the user to remove from the space.
  string user_id = 1 [(google.api.field_behavior) = REQUIRED];
}

message Member {
  // Role of a member in a space.
  enum Role {
    // Default value, should not be used.
    ROLE_UNSPECIFIED = 0;

    // Owner of the space with full permissions.
    OWNER = 1;

    // Admin of the space with elevated permissions,
    // but not full ownership. Cannot delete the space,
    // transfer ownership, or add/remove owners and admins.
    ADMIN = 2;

    // Regular member with standard permissions.
    MEMBER = 3;
  }

  message User {
    // The ID of the user.
    string id = 1;

    // The name of the user.
    string name = 2;

    // The email of the user.
    optional string email = 3;
  }

  // The ID of the user.
  string user_id = 1;

  // The role of the member in the space.
  Role role = 2;

  // The time the member was added to the space.
  google.protobuf.Timestamp join_time = 3;

  // Information about the user.
  User user = 4;
}
